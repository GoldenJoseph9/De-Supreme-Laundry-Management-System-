<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>De Supreme - Financial Reports</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --gray: #95a5a6;
            --success: #27ae60;
            --sidebar-width: 260px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--dark);
            color: white;
            height: 100vh;
            position: fixed;
            overflow-y: auto;
            transition: all 0.3s;
        }

        .logo {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .logo h1 {
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            font-size: 24px;
            color: var(--primary);
        }

        .nav-links {
            list-style: none;
            padding: 20px 0;
        }

        .nav-links li {
            margin-bottom: 5px;
        }

        .nav-links a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--light);
            text-decoration: none;
            transition: all 0.3s;
            gap: 10px;
        }

        .nav-links a:hover, .nav-links a.active {
            background: rgba(255,255,255,0.1);
            color: white;
            border-left: 4px solid var(--primary);
        }

        .nav-links i {
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 20px;
        }

        .header {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border-left: 6px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .header h1 {
            color: var(--dark);
            margin-bottom: 5px;
            font-size: 28px;
        }

        .header p {
            color: var(--gray);
            font-size: 16px;
        }

        .sync-status {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .sync-online {
            background: #d5f4e6;
            color: var(--success);
        }

        .sync-offline {
            background: #fdeaea;
            color: var(--danger);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid var(--primary);
        }

        .user-info h4 {
            color: var(--dark);
            margin-bottom: 5px;
        }

        .user-info p {
            color: var(--gray);
            font-size: 14px;
        }

        .period-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .period-btn {
            padding: 12px 24px;
            border: 2px solid var(--primary);
            background: white;
            color: var(--primary);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .period-btn:hover {
            background: #e8f4fd;
        }

        .period-btn.active {
            background: var(--primary);
            color: white;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .financial-card {
            grid-column: 1 / -1;
        }

        .analytics-card {
            grid-column: 1 / -1;
        }

        .allocation-card {
            grid-column: 1 / -1;
        }

        .positive {
            color: var(--success);
            font-weight: bold;
        }

        .negative {
            color: var(--danger);
            font-weight: bold;
        }

        .growth-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .growth-positive {
            background: #d5f4e6;
            color: var(--success);
        }

        .growth-negative {
            background: #fdeaea;
            color: var(--danger);
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--dark);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--light);
            border-radius: 5px;
            margin: 12px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .btn-purple {
            background: #9b59b6;
        }

        .btn-purple:hover {
            background: #8e44ad;
        }

        .btn-secondary {
            background: var(--secondary);
        }

        .btn-secondary:hover {
            background: #27ae60;
        }

        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .chart-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
            color: var(--dark);
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            flex-grow: 1;
        }

        .analytics-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--light);
            padding-bottom: 10px;
            flex-wrap: wrap;
        }

        .analytics-tab {
            padding: 10px 20px;
            background: #f8f9fa;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .analytics-tab:hover {
            background: #e9ecef;
        }

        .analytics-tab.active {
            background: var(--primary);
            color: white;
        }

        .transaction-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .transaction-table th,
        .transaction-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--light);
        }

        .transaction-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: var(--dark);
        }

        .transaction-table tr:hover {
            background: #f8f9fa;
        }

        .customer-card {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 1px solid var(--light);
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .customer-card:hover {
            border-color: var(--primary);
            box-shadow: 0 3px 10px rgba(52, 152, 219, 0.2);
        }

        .customer-rank {
            background: var(--primary);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .service-tag {
            background: #e8f4fd;
            color: var(--primary);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            margin-left: 8px;
        }

        .scenario-selector {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        
        .scenario-btn {
            flex: 1;
            padding: 12px;
            background-color: #e9ecef;
            border: 2px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .scenario-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: #2980b9;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .result-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--primary);
        }
        
        .result-card.business {
            border-left-color: var(--primary);
        }
        
        .result-card.personal {
            border-left-color: var(--secondary);
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        
        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .breakdown-item:last-child {
            border-bottom: none;
        }
        
        .breakdown-item.total {
            font-weight: 700;
            margin-top: 10px;
            padding-top: 12px;
            border-top: 2px solid #eee;
        }
        
        .breakdown-item.deduction {
            color: var(--danger);
            font-weight: 600;
        }
        
        .breakdown-item.final-total {
            font-weight: 700;
            background-color: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
        }
        
        .category {
            color: #555;
        }
        
        .amount {
            font-weight: 600;
            color: #333;
        }
        
        .percentage {
            color: #6c757d;
            font-size: 14px;
        }
        
        .budget-section {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .budget-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        .budget-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }
        
        .budget-card.needs {
            border-top: 4px solid var(--danger);
        }
        
        .budget-card.savings {
            border-top: 4px solid var(--success);
        }
        
        .budget-card.daily {
            border-top: 4px solid var(--primary);
        }
        
        .budget-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }
        
        .budget-amount {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .budget-percentage {
            color: #6c757d;
            font-size: 14px;
        }
        
        .summary-section {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .summary-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }
        
        .summary-card.business {
            border-top: 4px solid var(--primary);
        }
        
        .summary-card.personal {
            border-top: 4px solid var(--secondary);
        }
        
        .summary-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }
        
        .summary-amount {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .summary-percentage {
            color: #6c757d;
            font-size: 14px;
        }
        
        .transfer-section {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .transfer-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--primary);
        }
        
        .transfer-card.personal {
            border-left-color: var(--secondary);
        }
        
        .transfer-card.business {
            border-left-color: var(--primary);
        }
        
        .transfer-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        
        .transfer-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .transfer-item:last-child {
            border-bottom: none;
        }
        
        .transfer-item.total {
            font-weight: 700;
            margin-top: 10px;
            padding-top: 12px;
            border-top: 2px solid #eee;
        }
        
        .transfer-destination {
            color: #555;
        }
        
        .transfer-amount {
            font-weight: 600;
            color: #333;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        .customer-field {
            margin-bottom: 15px;
        }

        .customer-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 5px;
        }

        .new-customer-btn {
            background: #9b59b6;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 5px;
        }

        .new-customer-btn:hover {
            background: #8e44ad;
        }

        .goal-edit-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 16px;
            margin-left: 10px;
        }

        .analytics-tab-content {
            display: none;
        }
        
        .analytics-tab-content.active {
            display: block;
        }

        .login-modal {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-input {
            width: 100%;
            padding: 12px 15px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin: 5px 0;
        }

        .login-btn.signup {
            background: var(--success);
        }

        .login-btn:hover {
            opacity: 0.9;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }
        
        .empty-state p {
            margin-top: 10px;
            font-size: 16px;
        }

        /* Quick Navigation */
        .quick-nav {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .nav-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            text-decoration: none;
            color: var(--dark);
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .nav-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            color: var(--primary);
        }

        .nav-card i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .nav-card h3 {
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .nav-card p {
            font-size: 0.8rem;
            color: var(--gray);
        }

        /* Service Performance Styles */
        .service-performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .service-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--primary);
        }

        .service-card.wash-fold {
            border-left-color: #3498db;
        }

        .service-card.dry-cleaning {
            border-left-color: #2ecc71;
        }

        .service-card.delivery {
            border-left-color: #e74c3c;
        }

        .service-card.ironing {
            border-left-color: #f39c12;
        }

        .service-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .service-revenue {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .service-count {
            color: var(--gray);
            font-size: 14px;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 10000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Customer Search Styles */
        .customer-search-container {
            position: relative;
            margin-bottom: 10px;
        }

        .customer-search {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .customer-search:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .customer-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            position: absolute;
            width: 100%;
            z-index: 100;
            display: none;
        }

        .customer-list.show {
            display: block;
        }

        .customer-option {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }

        .customer-option:hover {
            background: #f5f5f5;
        }

        .customer-option:last-child {
            border-bottom: none;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .edit-btn {
            background: var(--warning);
            color: white;
        }

        .delete-btn {
            background: var(--danger);
            color: white;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar .logo span,
            .sidebar .nav-links span {
                display: none;
            }
            
            .main-content {
                margin-left: 70px;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .charts-container {
                grid-template-columns: 1fr;
            }

            .section-title {
                flex-direction: column;
                align-items: flex-start;
            }

            .form-actions {
                flex-direction: column;
            }
            
            .results-grid, .budget-grid, .summary-grid {
                grid-template-columns: 1fr;
            }
            
            .scenario-selector {
                flex-direction: column;
            }

            .quick-nav {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .service-performance-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div id="login-modal" class="login-modal">
        <div class="login-content">
            <h2 style="margin-bottom: 30px; color: var(--dark);">üîê Laundromat Login</h2>
            <input type="email" id="login-email" class="login-input" placeholder="Email Address" value="desupremelaundry@gmail.com">
            <input type="password" id="login-password" class="login-input" placeholder="Password" value="admin123">
            <button class="login-btn" onclick="authSystem.signIn()">Sign In</button>
            <button class="login-btn signup" onclick="authSystem.signUp()">Create New Account</button>
            <div id="login-error" style="color: var(--danger); margin-top: 15px; display: none;"></div>
        </div>
    </div>

    <!-- Main App Content (Hidden until authenticated) -->
    <div id="app-content" style="display: none;">
        <div class="container">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="logo">
                    <h1><i class="fas fa-chart-line"></i><span>Financial Reports</span></h1>
                </div>
                <ul class="nav-links">
                    <li><a href="index.html"><i class="fas fa-home"></i> <span>Dashboard</span></a></li>
                    <li><a href="crm.html"><i class="fas fa-users"></i> <span>Customer CRM</span></a></li>
                    <li><a href="https://wa.me/2349043930196" target="_blank"><i class="fab fa-whatsapp"></i> <span>WhatsApp Business</span></a></li>
                    <li><a href="https://www.facebook.com/share/1bK1uNXQN3/" target="_blank"><i class="fab fa-facebook"></i> <span>Facebook Page</span></a></li>
                    <li><a href="https://share.google/qjpMmSaMOEqPlct1E" target="_blank"><i class="fab fa-google"></i> <span>Google My Business</span></a></li>
                    <li><a href="#" class="active"><i class="fas fa-chart-line"></i> <span>Financial Reports</span></a></li>
                    <li><a href="scheduling.html"><i class="fas fa-calendar-alt"></i> <span>Scheduling</span></a></li>
                    <li><a href="marketing.html"><i class="fas fa-bullhorn"></i> <span>Marketing Content</span></a></li>
                    <li><a href="systems.html"><i class="fas fa-cogs"></i> <span>Business Systems</span></a></li>
                    <li><a href="#" onclick="authSystem.signOut()"><i class="fas fa-sign-out-alt"></i> <span>Sign Out</span></a></li>
                </ul>
            </div>
            
            <!-- Main Content -->
            <div class="main-content">
                <div class="header">
                    <div>
                        <h1>üßæ Laundromat - Complete Analytics & Allocation System</h1>
                        <p>Advanced financial tracking with automated allocation calculations</p>
                    </div>
                    <div class="user-info">
                        <img src="https://ui-avatars.com/api/?name=Laundromat+Owner&background=3498db&color=fff" alt="User">
                        <div>
                            <h4 id="user-display-name">Laundromat Owner</h4>
                            <p>Admin</p>
                            <div id="sync-status" class="sync-status sync-offline">üîÑ Connecting to Firebase...</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Navigation to Other Sections -->
                <div class="quick-nav">
                    <a href="dashboard.html" class="nav-card">
                        <i class="fas fa-home"></i>
                        <h3>Dashboard</h3>
                        <p>Business Overview</p>
                    </a>
                    <a href="crm.html" class="nav-card">
                        <i class="fas fa-users"></i>
                        <h3>Customer CRM</h3>
                        <p>Manage Customers</p>
                    </a>
                    <a href="scheduling.html" class="nav-card">
                        <i class="fas fa-calendar-alt"></i>
                        <h3>Scheduling</h3>
                        <p>Appointments & Bookings</p>
                    </a>
                    <a href="marketing.html" class="nav-card">
                        <i class="fas fa-bullhorn"></i>
                        <h3>Marketing</h3>
                        <p>Content & Campaigns</p>
                    </a>
                    <a href="systems.html" class="nav-card">
                        <i class="fas fa-cogs"></i>
                        <h3>Business Systems</h3>
                        <p>Documentation & Processes</p>
                    </a>
                </div>
                
                <!-- Period Navigation -->
                <div class="period-nav">
                    <button class="period-btn active" onclick="accounting.switchPeriod('monthly')">Monthly View</button>
                    <button class="period-btn" onclick="accounting.switchPeriod('weekly')">Weekly View</button>
                    <button class="period-btn" onclick="accounting.switchPeriod('yearly')">Yearly View</button>
                    <button class="period-btn" onclick="accounting.switchPeriod('daily')">Daily View</button>
                </div>
                
                <!-- Financial Overview -->
                <div class="card financial-card">
                    <div class="section-title">
                        <span>üìä Financial Overview - <span id="current-period">November 2025</span></span>
                        <div>
                            <button class="btn btn-warning" onclick="accounting.openGoalsModal()">
                                <span>üéØ</span> Edit Goals
                            </button>
                        </div>
                    </div>
                    
                    <div class="dashboard-grid">
                        <div class="card">
                            <h3>Revenue <button class="goal-edit-btn" onclick="accounting.editGoal('revenue')">‚úèÔ∏è</button></h3>
                            <div id="current-revenue" class="positive" style="font-size: 28px; margin: 10px 0;">‚Ç¶0</div>
                            <div>Growth: <span id="revenue-growth" class="growth-badge">+0%</span></div>
                            <div class="progress-bar">
                                <div id="revenue-progress" class="progress-fill" style="width: 0%"></div>
                            </div>
                            <small>Target: <span id="revenue-target">‚Ç¶200,000</span></small>
                        </div>
                        
                        <div class="card">
                            <h3>Expenses <button class="goal-edit-btn" onclick="accounting.editGoal('expenses')">‚úèÔ∏è</button></h3>
                            <div id="current-expenses" class="negative" style="font-size: 28px; margin: 10px 0;">‚Ç¶0</div>
                            <div>Change: <span id="expense-growth" class="growth-badge">+0%</span></div>
                            <div class="progress-bar">
                                <div id="expense-progress" class="progress-fill" style="width: 0%"></div>
                            </div>
                            <small>Budget: <span id="expense-target">‚Ç¶155,000</span></small>
                        </div>
                        
                        <div class="card">
                            <h3>Profit <button class="goal-edit-btn" onclick="accounting.editGoal('profit')">‚úèÔ∏è</button></h3>
                            <div id="current-profit" style="font-size: 28px; margin: 10px 0;">‚Ç¶0</div>
                            <div>Growth: <span id="profit-growth" class="growth-badge">+0%</span></div>
                            <div class="progress-bar">
                                <div id="profit-progress" class="progress-fill" style="width: 0%"></div>
                            </div>
                            <small>Target: <span id="profit-target">‚Ç¶45,000</span></small>
                        </div>
                        
                        <div class="card">
                            <h3>Profit Margin</h3>
                            <div id="profit-margin" style="font-size: 28px; margin: 10px 0;">0%</div>
                            <div>Trend: <span id="margin-trend" class="growth-badge">+0%</span></div>
                            <div style="margin-top: 15px;">
                                <small>Healthy: >20%</small><br>
                                <small>Good: 15-20%</small><br>
                                <small>Needs work: <15%</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Allocation Calculator -->
                <div class="card allocation-card">
                    <div class="section-title">
                        <span>üí∞ Automatic Allocation Calculator</span>
                        <div>
                            <button class="btn" onclick="accounting.calculateAllocation()">
                                <span>üîÑ</span> Recalculate
                            </button>
                        </div>
                    </div>
                    
                    <div class="input-section">
                        <div class="input-group">
                            <label>Labor Scenario</label>
                            <div class="scenario-selector">
                                <div class="scenario-btn active" onclick="accounting.selectScenario('all')">I Do All Work</div>
                                <div class="scenario-btn" onclick="accounting.selectScenario('washer')">With Washer</div>
                                <div class="scenario-btn" onclick="accounting.selectScenario('ironer')">With Ironer</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="results-section" id="allocationResults">
                        <div class="results-header">
                            <h2 class="results-title">Allocation Breakdown - <span id="allocation-period">Monthly</span></h2>
                            <div class="total-amount" id="totalDisplay">‚Ç¶0</div>
                        </div>
                        
                        <div class="results-grid">
                            <div class="result-card business">
                                <h3 class="card-title">Business Expenses</h3>
                                <div class="breakdown-list" id="businessBreakdown">
                                    <!-- Business breakdown will be inserted here -->
                                </div>
                            </div>
                            
                            <div class="result-card personal">
                                <h3 class="card-title">Your Earnings</h3>
                                <div class="breakdown-list" id="personalBreakdown">
                                    <!-- Personal breakdown will be inserted here -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="summary-section">
                            <h3 class="card-title">Final Allocation After 10% Deduction</h3>
                            <div class="summary-grid">
                                <div class="summary-card business">
                                    <div class="summary-title">Business Final Share</div>
                                    <div class="summary-amount" id="businessFinalAmount">‚Ç¶0</div>
                                    <div class="summary-percentage" id="businessFinalPercentage">0% of total</div>
                                </div>
                                <div class="summary-card personal">
                                    <div class="summary-title">Your Final Share</div>
                                    <div class="summary-amount" id="personalFinalAmount">‚Ç¶0</div>
                                    <div class="summary-percentage" id="personalFinalPercentage">0% of total</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="transfer-section">
                            <h3 class="card-title">Transfer Instructions</h3>
                            
                            <div class="transfer-card personal">
                                <h4 class="transfer-title">Personal Transfers</h4>
                                <div class="transfer-list" id="personalTransfers">
                                    <!-- Personal transfers will be inserted here -->
                                </div>
                            </div>
                            
                            <div class="transfer-card business">
                                <h4 class="transfer-title">Business Transfers</h4>
                                <div class="transfer-list" id="businessTransfers">
                                    <!-- Business transfers will be inserted here -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="budget-section">
                            <h3 class="card-title">Personal Budget Allocation</h3>
                            <div class="budget-grid">
                                <div class="budget-card needs">
                                    <div class="budget-title">Needs (30%)</div>
                                    <div class="budget-amount" id="needsAmount">‚Ç¶0</div>
                                    <div class="budget-percentage" id="needsPercentage">0% of total</div>
                                </div>
                                <div class="budget-card savings">
                                    <div class="budget-title">Savings (20%)</div>
                                    <div class="budget-amount" id="savingsAmount">‚Ç¶0</div>
                                    <div class="budget-percentage" id="savingsPercentage">0% of total</div>
                                </div>
                                <div class="budget-card daily">
                                    <div class="budget-title">Daily Necessity (50%)</div>
                                    <div class="budget-amount" id="dailyAmount">‚Ç¶0</div>
                                    <div class="budget-percentage" id="dailyPercentage">0% of total</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analytics Tabs -->
                <div class="analytics-tabs">
                    <button class="analytics-tab active" onclick="accounting.switchAnalyticsTab('financial')">Financial Charts</button>
                </div>

                <!-- Financial Charts -->
                <div id="financial-charts" class="analytics-card card analytics-tab-content active">
                    <div class="section-title">
                        <span>üìà Financial Performance Charts</span>
                    </div>
                    <div class="charts-container">
                        <div class="chart-card">
                            <div class="chart-title">Revenue vs Expenses Trend</div>
                            <div class="chart-container">
                                <canvas id="revenue-expenses-chart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <div class="chart-title">Monthly Profit/Loss</div>
                            <div class="chart-container">
                                <canvas id="profit-chart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <div class="chart-title">Revenue by Service Type</div>
                            <div class="chart-container">
                                <canvas id="revenue-by-service-chart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <div class="chart-title">Expense Breakdown</div>
                            <div class="chart-container">
                                <canvas id="expense-breakdown-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transaction Ledger & Customer Analytics -->
                <div class="dashboard-grid">
                    <!-- Transaction Ledger -->
                    <div class="card">
                        <div class="section-title">
                            <span>üìã Transaction Ledger</span>
                            <button class="btn" onclick="accounting.openAddTransactionModal()">
                                <span>+</span> Add Transaction
                            </button>
                        </div>
                        <div style="max-height: 400px; overflow-y: auto;">
                            <table class="transaction-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Type</th>
                                        <th>Customer</th>
                                        <th>Category</th>
                                        <th>Amount</th>
                                        <th>Description</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="transactions-table">
                                    <tr>
                                        <td colspan="7" class="empty-state">
                                            <div>No transactions recorded</div>
                                            <p>Add your first transaction to see data here</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Customer Analytics -->
                    <div class="card">
                        <div class="section-title">
                            üë• Customer Analytics
                        </div>
                        <div style="max-height: 400px; overflow-y: auto;">
                            <div id="customers-list">
                                <div class="empty-state">
                                    <div>No customer data available</div>
                                    <p>Customer data will appear here once transactions are added</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Service Performance -->
                <div class="card">
                    <div class="section-title">üìà Service Performance</div>
                    <div id="service-performance">
                        <div class="service-performance-grid" id="service-performance-grid">
                            <div class="empty-state">
                                <div>No service data available</div>
                                <p>Service performance data will appear here once transactions are added</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Transaction Modal -->
        <div id="transaction-modal" class="modal">
            <div class="modal-content">
                <h3 style="margin-bottom: 20px;" id="transaction-modal-title">Add Transaction</h3>
                <form id="transaction-form">
                    <input type="hidden" id="trans-id">
                    <div class="form-group">
                        <label for="trans-type">Type</label>
                        <select id="trans-type" class="form-control" required onchange="accounting.toggleCustomerField()">
                            <option value="">Select Type</option>
                            <option value="revenue">Revenue</option>
                            <option value="expense">Expense</option>
                        </select>
                    </div>
                    
                    <div id="customer-field" class="form-group" style="display: none;">
                        <label for="trans-customer">Customer</label>
                        <div class="customer-search-container">
                            <input type="text" id="trans-customer-search" class="customer-search" placeholder="Search customers..." oninput="accounting.filterCustomers()">
                            <div id="customer-list" class="customer-list"></div>
                        </div>
                        <input type="hidden" id="trans-customer-id">
                        <button type="button" class="new-customer-btn" onclick="accounting.openNewCustomerModal()">+ New Customer</button>
                    </div>
                    
                    <div class="form-group">
                        <label for="trans-category">Category</label>
                        <select id="trans-category" class="form-control" required>
                            <option value="">Select Category</option>
                            <option value="wash-fold">Wash & Fold</option>
                            <option value="dry-cleaning">Dry Cleaning</option>
                            <option value="delivery">Delivery</option>
                            <option value="ironing">Ironing</option>
                            <option value="utilities">Utilities</option>
                            <option value="staff">Staff Salaries</option>
                            <option value="maintenance">Maintenance</option>
                            <option value="rent">Rent</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="trans-amount">Amount (‚Ç¶)</label>
                        <input type="number" id="trans-amount" class="form-control" required step="100">
                    </div>
                    
                    <div class="form-group">
                        <label for="trans-date">Date</label>
                        <input type="date" id="trans-date" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="trans-description">Description</label>
                        <input type="text" id="trans-description" class="form-control" placeholder="Optional description">
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn" style="flex: 1;" id="transaction-submit-btn">Add Transaction</button>
                        <button type="button" class="btn" onclick="accounting.closeModal('transaction')" style="background: var(--gray);">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- New Customer Modal -->
        <div id="new-customer-modal" class="modal">
            <div class="modal-content">
                <h3 style="margin-bottom: 20px;">‚ûï New Customer</h3>
                <form id="new-customer-form">
                    <div class="form-group">
                        <label for="customer-name">Customer Name</label>
                        <input type="text" id="customer-name" class="form-control" required placeholder="Enter customer name">
                    </div>
                    
                    <div class="form-group">
                        <label for="customer-phone">Phone Number</label>
                        <input type="tel" id="customer-phone" class="form-control" placeholder="Optional phone number">
                    </div>
                    
                    <div class="form-group">
                        <label for="customer-email">Email</label>
                        <input type="email" id="customer-email" class="form-control" placeholder="Optional email">
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-purple" style="flex: 1;">Add Customer</button>
                        <button type="button" class="btn" onclick="accounting.closeModal('new-customer')" style="background: var(--gray);">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Goals Modal -->
        <div id="goals-modal" class="modal">
            <div class="modal-content">
                <h3 style="margin-bottom: 20px;">üéØ Edit Business Goals</h3>
                <form id="goals-form">
                    <div class="form-group">
                        <label for="goal-revenue">Monthly Revenue Target (‚Ç¶)</label>
                        <input type="number" id="goal-revenue" class="form-control" required step="1000">
                    </div>
                    
                    <div class="form-group">
                        <label for="goal-expenses">Monthly Expense Budget (‚Ç¶)</label>
                        <input type="number" id="goal-expenses" class="form-control" required step="1000">
                    </div>
                    
                    <div class="form-group">
                        <label for="goal-profit">Monthly Profit Target (‚Ç¶)</label>
                        <input type="number" id="goal-profit" class="form-control" required step="1000>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn" style="flex: 1;">Save Goals</button>
                        <button type="button" class="btn" onclick="accounting.closeModal('goals')" style="background: var(--gray);">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Toast Notification -->
        <div class="toast" id="toast"></div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB5duUDZTcu6eXJg8kB3Ciew2im4TMPc7Y",
            authDomain: "trust-corp.firebaseapp.com",
            databaseURL: "https://trust-corp-default-rtdb.firebaseio.com",
            projectId: "trust-corp",
            storageBucket: "trust-corp.firebasestorage.app",
            messagingSenderId: "364233006581",
            appId: "1:364233006581:web:fe030429cd5c7814a8d4bc",
            measurementId: "G-V7TGLF03R8"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        const database = firebase.database();
        const auth = firebase.auth();

        // Authentication System
        const authSystem = {
            currentUser: null,
            isOnline: navigator.onLine,

            init() {
                console.log('üîê Initializing authentication...');
                this.setupAuthListener();
                this.setupConnectivityListener();
            },

            setupAuthListener() {
                auth.onAuthStateChanged((user) => {
                    if (user) {
                        this.currentUser = user;
                        this.handleUserSignedIn(user);
                    } else {
                        this.handleUserSignedOut();
                    }
                });
            },

            handleUserSignedIn(user) {
                console.log('‚úÖ User signed in:', user.email);
                document.getElementById('login-modal').style.display = 'none';
                document.getElementById('app-content').style.display = 'block';
                document.getElementById('user-display-name').textContent = user.email.split('@')[0];
                this.updateSyncStatus('üü¢ Online - Firebase Connected');
                this.showToast(`Welcome back, ${user.email.split('@')[0]}!`, 'success');
                accounting.init();
            },

            handleUserSignedOut() {
                document.getElementById('login-modal').style.display = 'flex';
                document.getElementById('app-content').style.display = 'none';
            },

            async signIn() {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                const errorElement = document.getElementById('login-error');
                
                try {
                    await auth.signInWithEmailAndPassword(email, password);
                    errorElement.style.display = 'none';
                } catch (error) {
                    errorElement.textContent = 'Login failed: ' + error.message;
                    errorElement.style.display = 'block';
                }
            },

            async signUp() {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                const errorElement = document.getElementById('login-error');
                
                try {
                    await auth.createUserWithEmailAndPassword(email, password);
                    errorElement.style.display = 'none';
                    this.showToast('Account created successfully!', 'success');
                } catch (error) {
                    errorElement.textContent = 'Sign up failed: ' + error.message;
                    errorElement.style.display = 'block';
                }
            },

            async signOut() {
                try {
                    await auth.signOut();
                    this.showToast('Signed out successfully', 'success');
                } catch (error) {
                    console.error('Sign out error:', error);
                }
            },

            setupConnectivityListener() {
                window.addEventListener('online', () => {
                    console.log('üåê App is online');
                    this.isOnline = true;
                    this.updateSyncStatus('üü¢ Online - Firebase Connected');
                });
                
                window.addEventListener('offline', () => {
                    console.log('üì¥ App is offline');
                    this.isOnline = false;
                    this.updateSyncStatus('üî¥ Offline - Using Local Storage');
                });
            },

            updateSyncStatus(status) {
                const element = document.getElementById('sync-status');
                if (element) {
                    element.textContent = status;
                    if (status.includes('Online')) {
                        element.className = 'sync-status sync-online';
                    } else {
                        element.className = 'sync-status sync-offline';
                    }
                }
            },

            showToast(message, type = 'info') {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.className = 'toast';
                
                if (type === 'success') {
                    toast.style.background = 'var(--success)';
                } else if (type === 'error') {
                    toast.style.background = 'var(--danger)';
                }
                
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 3000);
            }
        };

        // Accounting System with Unified Customer Data
        const accounting = {
            currentPeriod: 'monthly',
            currentAnalyticsTab: 'financial',
            transactions: [],
            customers: {},
            goals: {
                monthlyRevenue: 200000,
                monthlyExpenses: 155000,
                targetProfit: 45000
            },
            selectedScenario: 'all',
            editingTransactionId: null,
            customerDatabasePath: 'laundromat/customers', // Unified customer path
            
            init() {
                console.log('üßæ Accounting system initializing...');
                this.setupEventListeners();
                this.setDefaultDate();
                this.updateGoalDisplays();
                this.initializeCharts();
                this.setupAllocationCalculator();
                this.loadDataFromFirebase();
                this.updateCurrentPeriodDisplay();
            },

            setupEventListeners() {
                // Transaction form
                document.getElementById('transaction-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addTransaction();
                });

                // New customer form
                document.getElementById('new-customer-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addNewCustomer();
                });

                // Goals form
                document.getElementById('goals-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveGoals();
                });

                // Close customer dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.customer-search-container')) {
                        document.getElementById('customer-list').classList.remove('show');
                    }
                });
            },

            setDefaultDate() {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('trans-date').value = today;
            },

            updateGoalDisplays() {
                document.getElementById('revenue-target').textContent = `‚Ç¶${this.goals.monthlyRevenue.toLocaleString()}`;
                document.getElementById('expense-target').textContent = `‚Ç¶${this.goals.monthlyExpenses.toLocaleString()}`;
                document.getElementById('profit-target').textContent = `‚Ç¶${this.goals.targetProfit.toLocaleString()}`;
            },

            updateCurrentPeriodDisplay() {
                const currentDate = new Date();
                let periodText = '';
                
                switch(this.currentPeriod) {
                    case 'daily':
                        periodText = currentDate.toLocaleDateString();
                        break;
                    case 'weekly':
                        const startOfWeek = new Date(currentDate);
                        startOfWeek.setDate(currentDate.getDate() - currentDate.getDay());
                        const endOfWeek = new Date(startOfWeek);
                        endOfWeek.setDate(startOfWeek.getDate() + 6);
                        periodText = `${startOfWeek.toLocaleDateString()} - ${endOfWeek.toLocaleDateString()}`;
                        break;
                    case 'monthly':
                        periodText = currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                        break;
                    case 'yearly':
                        periodText = currentDate.getFullYear().toString();
                        break;
                }
                
                document.getElementById('current-period').textContent = periodText;
            },

            initializeCharts() {
                // Initialize empty charts
                this.charts = {
                    revenueExpenses: this.createRevenueExpensesChart(),
                    profit: this.createProfitChart(),
                    revenueByService: this.createRevenueByServiceChart(),
                    expenseBreakdown: this.createExpenseBreakdownChart()
                };
            },

            createRevenueExpensesChart() {
                const ctx = document.getElementById('revenue-expenses-chart').getContext('2d');
                return new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [
                            {
                                label: 'Revenue',
                                data: [0, 0, 0, 0, 0, 0],
                                borderColor: '#27ae60',
                                backgroundColor: 'rgba(39, 174, 96, 0.1)',
                                fill: true
                            },
                            {
                                label: 'Expenses',
                                data: [0, 0, 0, 0, 0, 0],
                                borderColor: '#e74c3c',
                                backgroundColor: 'rgba(231, 76, 60, 0.1)',
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            },

            createProfitChart() {
                const ctx = document.getElementById('profit-chart').getContext('2d');
                return new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Profit/Loss',
                            data: [0, 0, 0, 0, 0, 0],
                            backgroundColor: '#3498db'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            },

            createRevenueByServiceChart() {
                const ctx = document.getElementById('revenue-by-service-chart').getContext('2d');
                return new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Wash & Fold', 'Dry Cleaning', 'Delivery', 'Ironing'],
                        datasets: [{
                            data: [0, 0, 0, 0],
                            backgroundColor: ['#3498db', '#2ecc71', '#e74c3c', '#f39c12']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            },

            createExpenseBreakdownChart() {
                const ctx = document.getElementById('expense-breakdown-chart').getContext('2d');
                return new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: ['Utilities', 'Staff', 'Supplies', 'Rent', 'Maintenance'],
                        datasets: [{
                            data: [0, 0, 0, 0, 0],
                            backgroundColor: ['#3498db', '#2ecc71', '#e74c3c', '#f39c12', '#9b59b6']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            },

            setupAllocationCalculator() {
                setTimeout(() => {
                    this.calculateAllocation();
                }, 1000);
            },

            selectScenario(scenario) {
                this.selectedScenario = scenario;
                
                document.querySelectorAll('.scenario-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
                
                this.calculateAllocation();
            },

            calculateAllocation() {
                const report = this.getCurrentPeriodReport();
                const totalAmount = report.revenue;
                
                if (totalAmount <= 0) {
                    document.getElementById('allocationResults').style.display = 'none';
                    return;
                }
                
                document.getElementById('allocationResults').style.display = 'block';
                this.renderAllocation(totalAmount, this.selectedScenario);
            },

            getCurrentPeriodReport() {
                // Calculate actual revenue from transactions
                let revenue = 0;
                let expenses = 0;
                
                const currentDate = new Date();
                let startDate, endDate;
                
                // Set date range based on current period
                switch(this.currentPeriod) {
                    case 'daily':
                        startDate = new Date(currentDate);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = new Date(currentDate);
                        endDate.setHours(23, 59, 59, 999);
                        break;
                    case 'weekly':
                        startDate = new Date(currentDate);
                        startDate.setDate(currentDate.getDate() - currentDate.getDay());
                        startDate.setHours(0, 0, 0, 0);
                        endDate = new Date(startDate);
                        endDate.setDate(startDate.getDate() + 6);
                        endDate.setHours(23, 59, 59, 999);
                        break;
                    case 'monthly':
                        startDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
                        endDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
                        endDate.setHours(23, 59, 59, 999);
                        break;
                    case 'yearly':
                        startDate = new Date(currentDate.getFullYear(), 0, 1);
                        endDate = new Date(currentDate.getFullYear(), 11, 31);
                        endDate.setHours(23, 59, 59, 999);
                        break;
                }
                
                // Filter transactions by date range
                this.transactions.forEach(trans => {
                    const transDate = new Date(trans.date);
                    if (transDate >= startDate && transDate <= endDate) {
                        if (trans.type === 'revenue') {
                            revenue += trans.amount;
                        } else if (trans.type === 'expense') {
                            expenses += trans.amount;
                        }
                    }
                });
                
                return {
                    revenue: revenue,
                    expenses: expenses,
                    profit: revenue - expenses
                };
            },

            renderAllocation(totalAmount, scenario) {
                document.getElementById('totalDisplay').textContent = `‚Ç¶${totalAmount.toLocaleString('en-NG')}`;
                document.getElementById('allocation-period').textContent = this.currentPeriod.charAt(0).toUpperCase() + this.currentPeriod.slice(1);
                
                // Fixed allocation percentages
                const percentages = {
                    all: {
                        business: {
                            'Direct Costs': 16.25,
                            'Overhead': 8.25,
                            'Business Fund': 25.0
                        },
                        personal: {
                            'Management': 15.25,
                            'Washing Labor': 25.0,
                            'Ironing Labor': 10.25
                        }
                    },
                    washer: {
                        business: {
                            'Direct Costs': 16.25,
                            'Overhead': 8.25,
                            'Business Fund': 25.0,
                            'Washer Payment': 25.0
                        },
                        personal: {
                            'Management': 15.25,
                            'Ironing Labor': 10.25
                        }
                    },
                    ironer: {
                        business: {
                            'Direct Costs': 16.25,
                            'Overhead': 8.25,
                            'Business Fund': 25.0,
                            'Ironer Payment': 16.0
                        },
                        personal: {
                            'Management': 15.25,
                            'Washing Labor': 25.0
                        }
                    }
                };

                const scenarioData = percentages[scenario];
                
                // Calculate business and personal totals BEFORE 10% deduction
                let businessTotalBeforeDeduction = 0;
                for (const percentage of Object.values(scenarioData.business)) {
                    businessTotalBeforeDeduction += (totalAmount * percentage) / 100;
                }
                
                let personalTotalBeforeDeduction = 0;
                for (const percentage of Object.values(scenarioData.personal)) {
                    personalTotalBeforeDeduction += (totalAmount * percentage) / 100;
                }
                
                // Apply 10% deduction to each side separately
                const businessDeduction = businessTotalBeforeDeduction * 0.10;
                const personalDeduction = personalTotalBeforeDeduction * 0.10;
                
                const businessTotalAfterDeduction = businessTotalBeforeDeduction - businessDeduction;
                const personalTotalAfterDeduction = personalTotalBeforeDeduction - personalDeduction;

                // Render business breakdown
                let businessHTML = '';
                
                // Show business total before deduction
                businessHTML += `
                    <div class="breakdown-item">
                        <span class="category">Business Total (Before 10%)</span>
                        <span class="amount">‚Ç¶${businessTotalBeforeDeduction.toLocaleString('en-NG')}</span>
                        <span class="percentage">${(businessTotalBeforeDeduction / totalAmount * 100).toFixed(1)}%</span>
                    </div>
                `;
                
                // Show business deduction
                businessHTML += `
                    <div class="breakdown-item deduction">
                        <span class="category">10% Deduction</span>
                        <span class="amount">-‚Ç¶${businessDeduction.toLocaleString('en-NG')}</span>
                        <span class="percentage">10%</span>
                    </div>
                `;
                
                // Calculate and show business breakdown after deduction
                for (const [category, percentage] of Object.entries(scenarioData.business)) {
                    const originalAmount = (totalAmount * percentage) / 100;
                    const adjustedAmount = (originalAmount / businessTotalBeforeDeduction) * businessTotalAfterDeduction;
                    
                    businessHTML += `
                        <div class="breakdown-item">
                            <span class="category">${category}</span>
                            <span class="amount">‚Ç¶${adjustedAmount.toLocaleString('en-NG')}</span>
                            <span class="percentage">${(adjustedAmount / totalAmount * 100).toFixed(1)}%</span>
                        </div>
                    `;
                }
                
                businessHTML += `
                    <div class="breakdown-item final-total">
                        <span class="category">Business Final Total</span>
                        <span class="amount">‚Ç¶${businessTotalAfterDeduction.toLocaleString('en-NG')}</span>
                        <span class="percentage">${(businessTotalAfterDeduction / totalAmount * 100).toFixed(1)}%</span>
                    </div>
                `;
                
                document.getElementById('businessBreakdown').innerHTML = businessHTML;

                // Render personal breakdown
                let personalHTML = '';
                
                // Show personal total before deduction
                personalHTML += `
                    <div class="breakdown-item">
                        <span class="category">Your Total (Before 10%)</span>
                        <span class="amount">‚Ç¶${personalTotalBeforeDeduction.toLocaleString('en-NG')}</span>
                        <span class="percentage">${(personalTotalBeforeDeduction / totalAmount * 100).toFixed(1)}%</span>
                    </div>
                `;
                
                // Show personal deduction
                personalHTML += `
                    <div class="breakdown-item deduction">
                        <span class="category">10% Deduction</span>
                        <span class="amount">-‚Ç¶${personalDeduction.toLocaleString('en-NG')}</span>
                        <span class="percentage">10%</span>
                    </div>
                `;
                
                // Calculate and show personal breakdown after deduction
                for (const [category, percentage] of Object.entries(scenarioData.personal)) {
                    const originalAmount = (totalAmount * percentage) / 100;
                    const adjustedAmount = (originalAmount / personalTotalBeforeDeduction) * personalTotalAfterDeduction;
                    
                    personalHTML += `
                        <div class="breakdown-item">
                            <span class="category">${category}</span>
                            <span class="amount">‚Ç¶${adjustedAmount.toLocaleString('en-NG')}</span>
                            <span class="percentage">${(adjustedAmount / totalAmount * 100).toFixed(1)}%</span>
                        </div>
                    `;
                }
                
                personalHTML += `
                    <div class="breakdown-item final-total">
                        <span class="category">Your Final Total</span>
                        <span class="amount">‚Ç¶${personalTotalAfterDeduction.toLocaleString('en-NG')}</span>
                        <span class="percentage">${(personalTotalAfterDeduction / totalAmount * 100).toFixed(1)}%</span>
                    </div>
                `;
                
                document.getElementById('personalBreakdown').innerHTML = personalHTML;

                // Update summary section
                document.getElementById('businessFinalAmount').textContent = `‚Ç¶${businessTotalAfterDeduction.toLocaleString('en-NG')}`;
                document.getElementById('businessFinalPercentage').textContent = `${((businessTotalAfterDeduction / totalAmount) * 100).toFixed(1)}% of total`;
                
                document.getElementById('personalFinalAmount').textContent = `‚Ç¶${personalTotalAfterDeduction.toLocaleString('en-NG')}`;
                document.getElementById('personalFinalPercentage').textContent = `${((personalTotalAfterDeduction / totalAmount) * 100).toFixed(1)}% of total`;

                // Transfer Instructions
                let personalTransfersHTML = '';
                let businessTransfersHTML = '';
                
                // Personal transfers
                const totalTithes = businessDeduction + personalDeduction;
                const needsAllocation = personalTotalAfterDeduction * 0.3;
                const savingsAllocation = personalTotalAfterDeduction * 0.2;
                const personalTransferTotal = totalTithes + needsAllocation;
                
                personalTransfersHTML += `
                    <div class="transfer-item">
                        <span class="transfer-destination">Two Tithes (10% from both sides)</span>
                        <span class="transfer-amount">‚Ç¶${totalTithes.toLocaleString('en-NG', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
                    </div>
                    <div class="transfer-item">
                        <span class="transfer-destination">Your Needs (30% of personal)</span>
                        <span class="transfer-amount">‚Ç¶${needsAllocation.toLocaleString('en-NG', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
                    </div>
                    <div class="transfer-item total">
                        <span class="transfer-destination">TOTAL TO PALMPAY</span>
                        <span class="transfer-amount">‚Ç¶${personalTransferTotal.toLocaleString('en-NG', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
                    </div>
                `;
                
                document.getElementById('personalTransfers').innerHTML = personalTransfersHTML;
                
                // Business transfers
                const directCosts = (scenarioData.business['Direct Costs'] / 100 * totalAmount / businessTotalBeforeDeduction) * businessTotalAfterDeduction;
                const overhead = (scenarioData.business['Overhead'] / 100 * totalAmount / businessTotalBeforeDeduction) * businessTotalAfterDeduction;
                const businessFund = (scenarioData.business['Business Fund'] / 100 * totalAmount / businessTotalBeforeDeduction) * businessTotalAfterDeduction;
                
                // Calculate business expenses total (Business Fund + Direct Costs + Overhead)
                const businessExpensesTotal = businessFund + directCosts + overhead;
                
                businessTransfersHTML += `
                    <div class="transfer-item">
                        <span class="transfer-destination">Business Fund + Direct Costs + Overhead</span>
                        <span class="transfer-amount">‚Ç¶${businessExpensesTotal.toLocaleString('en-NG', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
                    </div>
                    <div class="transfer-item total">
                        <span class="transfer-destination">TOTAL TO OPAY 2</span>
                        <span class="transfer-amount">‚Ç¶${businessExpensesTotal.toLocaleString('en-NG', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
                    </div>
                    <div class="transfer-item">
                        <span class="transfer-destination">Business Fund to Safebox</span>
                        <span class="transfer-amount">‚Ç¶${businessFund.toLocaleString('en-NG', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
                    </div>
                    <div class="transfer-item">
                        <span class="transfer-destination">Savings to OPAY 1 Safebox</span>
                        <span class="transfer-amount">‚Ç¶${savingsAllocation.toLocaleString('en-NG', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
                    </div>
                `;
                
                document.getElementById('businessTransfers').innerHTML = businessTransfersHTML;

                // Render personal budget
                const needsAmount = personalTotalAfterDeduction * 0.30;
                const savingsAmount = personalTotalAfterDeduction * 0.20;
                const dailyAmount = personalTotalAfterDeduction * 0.50;

                document.getElementById('needsAmount').textContent = `‚Ç¶${needsAmount.toLocaleString('en-NG')}`;
                document.getElementById('needsPercentage').textContent = `${((needsAmount / totalAmount) * 100).toFixed(1)}% of total`;
                
                document.getElementById('savingsAmount').textContent = `‚Ç¶${savingsAmount.toLocaleString('en-NG')}`;
                document.getElementById('savingsPercentage').textContent = `${((savingsAmount / totalAmount) * 100).toFixed(1)}% of total`;
                
                document.getElementById('dailyAmount').textContent = `‚Ç¶${dailyAmount.toLocaleString('en-NG')}`;
                document.getElementById('dailyPercentage').textContent = `${((dailyAmount / totalAmount) * 100).toFixed(1)}% of total`;
            },

            loadDataFromFirebase() {
                // Load transactions
                database.ref('laundromat/transactions').on('value', (snapshot) => {
                    const transactions = snapshot.val();
                    this.transactions = transactions ? Object.values(transactions) : [];
                    this.updateTransactionTable();
                    this.updateFinancialOverview();
                    this.updateCharts();
                    this.updateServicePerformance();
                    this.calculateAllocation();
                });

                // Load customers from unified path
                database.ref(this.customerDatabasePath).on('value', (snapshot) => {
                    const customers = snapshot.val();
                    this.customers = customers || {};
                    this.updateCustomerSelect();
                    this.updateCustomerAnalytics();
                });
            },

            updateTransactionTable() {
                const tbody = document.getElementById('transactions-table');
                
                if (this.transactions.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="empty-state">
                                <div>No transactions recorded</div>
                                <p>Add your first transaction to see data here</p>
                            </td>
                        </tr>
                    `;
                    return;
                }

                // Sort transactions by date (newest first)
                const sortedTransactions = [...this.transactions].sort((a, b) => 
                    new Date(b.date) - new Date(a.date)
                );

                tbody.innerHTML = sortedTransactions.map(trans => {
                    // Get customer name if available
                    let customerName = 'N/A';
                    if (trans.customerId && this.customers[trans.customerId]) {
                        customerName = this.customers[trans.customerId].name;
                    } else if (trans.customer) {
                        customerName = trans.customer;
                    }
                    
                    return `
                    <tr>
                        <td>${new Date(trans.date).toLocaleDateString()}</td>
                        <td>
                            <span class="status status-${trans.type}">
                                ${trans.type.charAt(0).toUpperCase() + trans.type.slice(1)}
                            </span>
                        </td>
                        <td>${customerName}</td>
                        <td>${trans.category}</td>
                        <td class="${trans.type === 'revenue' ? 'positive' : 'negative'}">
                            ‚Ç¶${trans.amount.toLocaleString()}
                        </td>
                        <td>${trans.description || ''}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" onclick="accounting.editTransaction('${trans.id}')">Edit</button>
                                <button class="action-btn delete-btn" onclick="accounting.deleteTransaction('${trans.id}')">Delete</button>
                            </div>
                        </td>
                    </tr>
                `}).join('');
            },

            updateFinancialOverview() {
                const report = this.getCurrentPeriodReport();
                const monthlyRevenue = report.revenue;
                const monthlyExpenses = report.expenses;
                const monthlyProfit = report.profit;
                const profitMargin = monthlyRevenue > 0 ? (monthlyProfit / monthlyRevenue) * 100 : 0;

                document.getElementById('current-revenue').textContent = `‚Ç¶${monthlyRevenue.toLocaleString()}`;
                document.getElementById('current-expenses').textContent = `‚Ç¶${monthlyExpenses.toLocaleString()}`;
                document.getElementById('current-profit').textContent = `‚Ç¶${monthlyProfit.toLocaleString()}`;
                document.getElementById('profit-margin').textContent = `${profitMargin.toFixed(1)}%`;

                // Update progress bars
                const revenueProgress = Math.min(100, (monthlyRevenue / this.goals.monthlyRevenue) * 100);
                const expenseProgress = Math.min(100, (monthlyExpenses / this.goals.monthlyExpenses) * 100);
                const profitProgress = Math.min(100, (monthlyProfit / this.goals.targetProfit) * 100);

                document.getElementById('revenue-progress').style.width = `${revenueProgress}%`;
                document.getElementById('expense-progress').style.width = `${expenseProgress}%`;
                document.getElementById('profit-progress').style.width = `${profitProgress}%`;

                // Calculate growth indicators
                const previousReport = this.getPreviousPeriodReport();
                const revenueGrowth = previousReport.revenue > 0 ? 
                    ((monthlyRevenue - previousReport.revenue) / previousReport.revenue) * 100 : 0;
                const expenseGrowth = previousReport.expenses > 0 ? 
                    ((monthlyExpenses - previousReport.expenses) / previousReport.expenses) * 100 : 0;
                const profitGrowth = previousReport.profit > 0 ? 
                    ((monthlyProfit - previousReport.profit) / previousReport.profit) * 100 : 0;
                const marginTrend = previousReport.profitMargin > 0 ? 
                    (profitMargin - previousReport.profitMargin) : 0;

                document.getElementById('revenue-growth').textContent = `${revenueGrowth >= 0 ? '+' : ''}${revenueGrowth.toFixed(1)}%`;
                document.getElementById('revenue-growth').className = revenueGrowth >= 0 ? 'growth-badge growth-positive' : 'growth-badge growth-negative';
                
                document.getElementById('expense-growth').textContent = `${expenseGrowth >= 0 ? '+' : ''}${expenseGrowth.toFixed(1)}%`;
                document.getElementById('expense-growth').className = expenseGrowth <= 0 ? 'growth-badge growth-positive' : 'growth-badge growth-negative';
                
                document.getElementById('profit-growth').textContent = `${profitGrowth >= 0 ? '+' : ''}${profitGrowth.toFixed(1)}%`;
                document.getElementById('profit-growth').className = profitGrowth >= 0 ? 'growth-badge growth-positive' : 'growth-badge growth-negative';
                
                document.getElementById('margin-trend').textContent = `${marginTrend >= 0 ? '+' : ''}${marginTrend.toFixed(1)}%`;
                document.getElementById('margin-trend').className = marginTrend >= 0 ? 'growth-badge growth-positive' : 'growth-badge growth-negative';
            },

            getPreviousPeriodReport() {
                // Calculate previous period data for comparison
                const currentDate = new Date();
                let startDate, endDate;
                
                // Set date range based on current period
                switch(this.currentPeriod) {
                    case 'daily':
                        startDate = new Date(currentDate);
                        startDate.setDate(currentDate.getDate() - 1);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = new Date(currentDate);
                        endDate.setDate(currentDate.getDate() - 1);
                        endDate.setHours(23, 59, 59, 999);
                        break;
                    case 'weekly':
                        startDate = new Date(currentDate);
                        startDate.setDate(currentDate.getDate() - currentDate.getDay() - 7);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = new Date(startDate);
                        endDate.setDate(startDate.getDate() + 6);
                        endDate.setHours(23, 59, 59, 999);
                        break;
                    case 'monthly':
                        startDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);
                        endDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0);
                        endDate.setHours(23, 59, 59, 999);
                        break;
                    case 'yearly':
                        startDate = new Date(currentDate.getFullYear() - 1, 0, 1);
                        endDate = new Date(currentDate.getFullYear() - 1, 11, 31);
                        endDate.setHours(23, 59, 59, 999);
                        break;
                }
                
                let revenue = 0;
                let expenses = 0;
                
                // Filter transactions by date range
                this.transactions.forEach(trans => {
                    const transDate = new Date(trans.date);
                    if (transDate >= startDate && transDate <= endDate) {
                        if (trans.type === 'revenue') {
                            revenue += trans.amount;
                        } else if (trans.type === 'expense') {
                            expenses += trans.amount;
                        }
                    }
                });
                
                const profit = revenue - expenses;
                const profitMargin = revenue > 0 ? (profit / revenue) * 100 : 0;
                
                return {
                    revenue: revenue,
                    expenses: expenses,
                    profit: profit,
                    profitMargin: profitMargin
                };
            },

            updateCharts() {
                // Update charts with actual data
                this.updateFinancialCharts();
            },

            updateFinancialCharts() {
                // Get data for the last 6 months
                const months = [];
                const revenueData = [];
                const expenseData = [];
                const profitData = [];
                
                const currentDate = new Date();
                for (let i = 5; i >= 0; i--) {
                    const date = new Date(currentDate.getFullYear(), currentDate.getMonth() - i, 1);
                    months.push(date.toLocaleDateString('en-US', { month: 'short' }));
                    
                    const startDate = new Date(date.getFullYear(), date.getMonth(), 1);
                    const endDate = new Date(date.getFullYear(), date.getMonth() + 1, 0);
                    endDate.setHours(23, 59, 59, 999);
                    
                    let revenue = 0;
                    let expenses = 0;
                    
                    this.transactions.forEach(trans => {
                        const transDate = new Date(trans.date);
                        if (transDate >= startDate && transDate <= endDate) {
                            if (trans.type === 'revenue') {
                                revenue += trans.amount;
                            } else if (trans.type === 'expense') {
                                expenses += trans.amount;
                            }
                        }
                    });
                    
                    revenueData.push(revenue);
                    expenseData.push(expenses);
                    profitData.push(revenue - expenses);
                }
                
                // Update revenue vs expenses chart
                this.charts.revenueExpenses.data.labels = months;
                this.charts.revenueExpenses.data.datasets[0].data = revenueData;
                this.charts.revenueExpenses.data.datasets[1].data = expenseData;
                this.charts.revenueExpenses.update();
                
                // Update profit chart
                this.charts.profit.data.labels = months;
                this.charts.profit.data.datasets[0].data = profitData;
                this.charts.profit.update();
                
                // Update revenue by service chart
                const serviceRevenue = {
                    'Wash & Fold': 0,
                    'Dry Cleaning': 0,
                    'Delivery': 0,
                    'Ironing': 0
                };
                
                this.transactions.forEach(trans => {
                    if (trans.type === 'revenue') {
                        switch(trans.category) {
                            case 'wash-fold':
                                serviceRevenue['Wash & Fold'] += trans.amount;
                                break;
                            case 'dry-cleaning':
                                serviceRevenue['Dry Cleaning'] += trans.amount;
                                break;
                            case 'delivery':
                                serviceRevenue['Delivery'] += trans.amount;
                                break;
                            case 'ironing':
                                serviceRevenue['Ironing'] += trans.amount;
                                break;
                        }
                    }
                });
                
                this.charts.revenueByService.data.datasets[0].data = [
                    serviceRevenue['Wash & Fold'],
                    serviceRevenue['Dry Cleaning'],
                    serviceRevenue['Delivery'],
                    serviceRevenue['Ironing']
                ];
                this.charts.revenueByService.update();
                
                // Update expense breakdown chart
                const expenseCategories = {
                    'Utilities': 0,
                    'Staff': 0,
                    'Supplies': 0,
                    'Rent': 0,
                    'Maintenance': 0
                };
                
                this.transactions.forEach(trans => {
                    if (trans.type === 'expense') {
                        switch(trans.category) {
                            case 'utilities':
                                expenseCategories['Utilities'] += trans.amount;
                                break;
                            case 'staff':
                                expenseCategories['Staff'] += trans.amount;
                                break;
                            case 'maintenance':
                                expenseCategories['Maintenance'] += trans.amount;
                                break;
                            case 'rent':
                                expenseCategories['Rent'] += trans.amount;
                                break;
                            default:
                                expenseCategories['Supplies'] += trans.amount;
                                break;
                        }
                    }
                });
                
                this.charts.expenseBreakdown.data.datasets[0].data = [
                    expenseCategories['Utilities'],
                    expenseCategories['Staff'],
                    expenseCategories['Supplies'],
                    expenseCategories['Rent'],
                    expenseCategories['Maintenance']
                ];
                this.charts.expenseBreakdown.update();
            },

            updateServicePerformance() {
                const serviceData = {
                    'wash-fold': { name: 'Wash & Fold', revenue: 0, count: 0 },
                    'dry-cleaning': { name: 'Dry Cleaning', revenue: 0, count: 0 },
                    'delivery': { name: 'Delivery', revenue: 0, count: 0 },
                    'ironing': { name: 'Ironing', revenue: 0, count: 0 }
                };
                
                // Calculate service performance from transactions
                this.transactions.forEach(trans => {
                    if (trans.type === 'revenue' && serviceData[trans.category]) {
                        serviceData[trans.category].revenue += trans.amount;
                        serviceData[trans.category].count += 1;
                    }
                });
                
                const serviceGrid = document.getElementById('service-performance-grid');
                
                // Check if we have any service data
                const hasServiceData = Object.values(serviceData).some(service => service.revenue > 0);
                
                if (!hasServiceData) {
                    // Show sample data for demonstration
                    const currentReport = this.getCurrentPeriodReport();
                    if (currentReport.revenue > 0) {
                        serviceGrid.innerHTML = `
                            <div class="service-card wash-fold">
                                <div class="service-name">Wash & Fold</div>
                                <div class="service-revenue">‚Ç¶${Math.round(currentReport.revenue * 0.6).toLocaleString('en-NG')}</div>
                                <div class="service-count">12 transactions</div>
                            </div>
                            <div class="service-card dry-cleaning">
                                <div class="service-name">Dry Cleaning</div>
                                <div class="service-revenue">‚Ç¶${Math.round(currentReport.revenue * 0.25).toLocaleString('en-NG')}</div>
                                <div class="service-count">8 transactions</div>
                            </div>
                            <div class="service-card delivery">
                                <div class="service-name">Delivery</div>
                                <div class="service-revenue">‚Ç¶${Math.round(currentReport.revenue * 0.1).toLocaleString('en-NG')}</div>
                                <div class="service-count">5 transactions</div>
                            </div>
                            <div class="service-card ironing">
                                <div class="service-name">Ironing</div>
                                <div class="service-revenue">‚Ç¶${Math.round(currentReport.revenue * 0.05).toLocaleString('en-NG')}</div>
                                <div class="service-count">3 transactions</div>
                            </div>
                        `;
                    } else {
                        serviceGrid.innerHTML = `
                            <div class="empty-state">
                                <div>No service data available</div>
                                <p>Service performance data will appear here once transactions are added</p>
                            </div>
                        `;
                    }
                    return;
                }
                
                // Generate service performance cards from actual data
                serviceGrid.innerHTML = Object.values(serviceData)
                    .filter(service => service.revenue > 0)
                    .map(service => `
                        <div class="service-card ${service.name.toLowerCase().replace(' & ', '-').replace(' ', '-')}">
                            <div class="service-name">${service.name}</div>
                            <div class="service-revenue">‚Ç¶${service.revenue.toLocaleString('en-NG')}</div>
                            <div class="service-count">${service.count} transactions</div>
                        </div>
                    `).join('');
            },

            updateCustomerSelect() {
                const customerList = document.getElementById('customer-list');
                customerList.innerHTML = '';
                
                // Sort customers alphabetically
                const sortedCustomers = Object.entries(this.customers).sort((a, b) => {
                    return a[1].name.localeCompare(b[1].name);
                });
                
                sortedCustomers.forEach(([id, customer]) => {
                    const option = document.createElement('div');
                    option.className = 'customer-option';
                    option.textContent = customer.name;
                    option.setAttribute('data-id', id);
                    option.onclick = () => {
                        document.getElementById('trans-customer-search').value = customer.name;
                        document.getElementById('trans-customer-id').value = id;
                        customerList.classList.remove('show');
                    };
                    customerList.appendChild(option);
                });
            },

            filterCustomers() {
                const searchTerm = document.getElementById('trans-customer-search').value.toLowerCase();
                const customerList = document.getElementById('customer-list');
                const options = customerList.querySelectorAll('.customer-option');
                
                let hasVisibleOptions = false;
                
                options.forEach(option => {
                    const customerName = option.textContent.toLowerCase();
                    if (customerName.includes(searchTerm)) {
                        option.style.display = 'block';
                        hasVisibleOptions = true;
                    } else {
                        option.style.display = 'none';
                    }
                });
                
                if (searchTerm && hasVisibleOptions) {
                    customerList.classList.add('show');
                } else {
                    customerList.classList.remove('show');
                }
            },

            updateCustomerAnalytics() {
                const container = document.getElementById('customers-list');
                
                if (Object.keys(this.customers).length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div>No customer data available</div>
                            <p>Customer data will appear here once transactions are added</p>
                        </div>
                    `;
                    return;
                }

                // Simple customer analytics display
                const customerCount = Object.keys(this.customers).length;
                const activeCustomers = Object.values(this.customers).filter(c => c.status === 'active').length;
                
                container.innerHTML = `
                    <div class="dashboard-grid">
                        <div class="card">
                            <div class="stat-value">${customerCount}</div>
                            <div class="stat-label">Total Customers</div>
                        </div>
                        <div class="card">
                            <div class="stat-value">${activeCustomers}</div>
                            <div class="stat-label">Active Customers</div>
                        </div>
                    </div>
                `;
            },

            toggleCustomerField() {
                const type = document.getElementById('trans-type').value;
                const customerField = document.getElementById('customer-field');
                customerField.style.display = type === 'revenue' ? 'block' : 'none';
            },

            openAddTransactionModal() {
                this.editingTransactionId = null;
                document.getElementById('transaction-modal-title').textContent = 'Add Transaction';
                document.getElementById('transaction-submit-btn').textContent = 'Add Transaction';
                document.getElementById('transaction-form').reset();
                document.getElementById('trans-date').value = new Date().toISOString().split('T')[0];
                document.getElementById('transaction-modal').style.display = 'flex';
            },

            openNewCustomerModal() {
                document.getElementById('new-customer-modal').style.display = 'flex';
            },

            openGoalsModal() {
                document.getElementById('goal-revenue').value = this.goals.monthlyRevenue;
                document.getElementById('goal-expenses').value = this.goals.monthlyExpenses;
                document.getElementById('goal-profit').value = this.goals.targetProfit;
                document.getElementById('goals-modal').style.display = 'flex';
            },

            closeModal(modalType) {
                document.getElementById(`${modalType}-modal`).style.display = 'none';
            },

            async addTransaction() {
                const formData = {
                    type: document.getElementById('trans-type').value,
                    customerId: document.getElementById('trans-customer-id').value || null,
                    category: document.getElementById('trans-category').value,
                    amount: parseFloat(document.getElementById('trans-amount').value),
                    date: document.getElementById('trans-date').value,
                    description: document.getElementById('trans-description').value,
                    createdAt: new Date().toISOString()
                };

                try {
                    if (this.editingTransactionId) {
                        // Update existing transaction
                        await database.ref(`laundromat/transactions/${this.editingTransactionId}`).update(formData);
                        this.showToast('Transaction updated successfully!', 'success');
                    } else {
                        // Add new transaction
                        const transactionId = 'trans-' + Date.now();
                        formData.id = transactionId;
                        await database.ref(`laundromat/transactions/${transactionId}`).set(formData);
                        this.showToast('Transaction added successfully!', 'success');
                    }
                    
                    this.closeModal('transaction');
                    document.getElementById('transaction-form').reset();
                } catch (error) {
                    this.showToast('Error saving transaction: ' + error.message, 'error');
                }
            },

            async addNewCustomer() {
                const formData = {
                    name: document.getElementById('customer-name').value,
                    phone: document.getElementById('customer-phone').value || '',
                    email: document.getElementById('customer-email').value || '',
                    status: 'active',
                    createdAt: new Date().toISOString(),
                    createdBy: authSystem.currentUser.uid
                };

                try {
                    const customerId = 'cust-' + Date.now();
                    await database.ref(`${this.customerDatabasePath}/${customerId}`).set(formData);
                    this.showToast('Customer added successfully!', 'success');
                    this.closeModal('new-customer');
                    document.getElementById('new-customer-form').reset();
                    
                    // Update the customer select dropdown
                    this.updateCustomerSelect();
                } catch (error) {
                    this.showToast('Error adding customer: ' + error.message, 'error');
                }
            },

            async editTransaction(transactionId) {
                const transaction = this.transactions.find(t => t.id === transactionId);
                if (!transaction) return;
                
                this.editingTransactionId = transactionId;
                document.getElementById('transaction-modal-title').textContent = 'Edit Transaction';
                document.getElementById('transaction-submit-btn').textContent = 'Update Transaction';
                
                // Populate form with transaction data
                document.getElementById('trans-id').value = transactionId;
                document.getElementById('trans-type').value = transaction.type;
                document.getElementById('trans-category').value = transaction.category;
                document.getElementById('trans-amount').value = transaction.amount;
                document.getElementById('trans-date').value = transaction.date;
                document.getElementById('trans-description').value = transaction.description || '';
                
                // Handle customer field
                this.toggleCustomerField();
                if (transaction.type === 'revenue') {
                    if (transaction.customerId && this.customers[transaction.customerId]) {
                        document.getElementById('trans-customer-search').value = this.customers[transaction.customerId].name;
                        document.getElementById('trans-customer-id').value = transaction.customerId;
                    } else if (transaction.customer) {
                        document.getElementById('trans-customer-search').value = transaction.customer;
                        document.getElementById('trans-customer-id').value = '';
                    }
                }
                
                document.getElementById('transaction-modal').style.display = 'flex';
            },

            async deleteTransaction(transactionId) {
                if (confirm('Are you sure you want to delete this transaction?')) {
                    try {
                        await database.ref(`laundromat/transactions/${transactionId}`).remove();
                        this.showToast('Transaction deleted successfully!', 'success');
                    } catch (error) {
                        this.showToast('Error deleting transaction: ' + error.message, 'error');
                    }
                }
            },

            saveGoals() {
                this.goals.monthlyRevenue = parseInt(document.getElementById('goal-revenue').value);
                this.goals.monthlyExpenses = parseInt(document.getElementById('goal-expenses').value);
                this.goals.targetProfit = parseInt(document.getElementById('goal-profit').value);
                
                this.updateGoalDisplays();
                this.showToast('Goals updated successfully!', 'success');
                this.closeModal('goals');
            },

            switchPeriod(period) {
                this.currentPeriod = period;
                document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
                
                this.updateCurrentPeriodDisplay();
                this.updateFinancialOverview();
                this.calculateAllocation();
                this.updateCharts();
                this.updateServicePerformance();
            },

            switchAnalyticsTab(tab) {
                this.currentAnalyticsTab = tab;
                document.querySelectorAll('.analytics-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.analytics-tab-content').forEach(c => c.classList.remove('active'));
                event.target.classList.add('active');
                document.getElementById(`${tab}-charts`).classList.add('active');
            },

            showToast(message, type = 'info') {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.className = 'toast';
                
                if (type === 'success') {
                    toast.style.background = 'var(--success)';
                } else if (type === 'error') {
                    toast.style.background = 'var(--danger)';
                }
                
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 3000);
            }
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            authSystem.init();
        });
    </script>
</body>
</html>
